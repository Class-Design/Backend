<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.BookDAO">
    <resultMap id="bookResultMap" type="com.example.demo.model.dataobject.BookDO">
        <id column="id" property="id"/>
        <result column="book_id" property="bookId"/>
        <result column="name" property="name"/>
        <result column="author" property="author"/>
        <result column="price" property="price"/>
        <result column="publish" property="publish"/>
        <result column="reserve" property="reserve"/>
    </resultMap>
    <resultMap id="bookDetailResultMap" type="com.example.demo.model.dataobject.BookDetailDO">
        <id column="id" property="id"/>
        <result column="book_id" property="bookId"/>
        <result column="detail_id" property="detailId"/>
        <result column="status" property="status"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <sql id="book_base">book_id,name,author,price,publish,reserve</sql>
    <sql id="book_detail_base">book_id,detail_id,status,remark</sql>
    <insert id="addBook" parameterType="com.example.demo.model.dataobject.BookDO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO books
        (<include refid="book_base"/>)
        VALUES(#{bookId},#{name},#{author},#{price},#{publish},#{reserve})
    </insert>
    <insert id="addBookDetail" parameterType="com.example.demo.model.dataobject.BookDetailDO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO book_details
        (<include refid="book_detail_base"/>)
        VALUES(#{bookId},#{detailId},#{status},#{remark})
    </insert>
    <update id="updateBook" parameterType="com.example.demo.model.dataobject.BookDO">
        UPDATE books
        <set>
            <if test="bookId != null">book_id=#{bookId}</if>
            <if test="name != null">name=#{name}</if>
            <if test="author != null">author=#{author}</if>
            <if test="price != null">price=#{price}</if>
            <if test="publish != null">publish=#{publish}</if>
            <if test="reserve != null">reserve=#{reserve}</if>
        </set>
        WHERE id=#{id}
    </update>
    <update id="updateBookDetail" parameterType="com.example.demo.model.dataobject.BookDetailDO">
        UPDATE book_details
        <set>
            <if test="bookId!=null">book_id=#{bookId}</if>
            <if test="detailId!=null">detail_id=#{detailId}</if>
            <if test="status!=null">status=#{status}</if>
            <if test="remark!=null">remark=#{remark}</if>
        </set>
        WHERE id=#{id}
    </update>
</mapper>